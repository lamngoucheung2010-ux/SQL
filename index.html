<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HKDSE SQLå­¸ç¿’æ¨¡æ“¬å™¨ - é¦™æ¸¯è—äººæ•¸æ“šåº«</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft JhengHei', 'Arial', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        header {
            background-color: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        header h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        header p {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 20px;
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .sql-input-section {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .section-title {
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #3498db;
        }
        
        .instructions {
            background: #e8f4fd;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-size: 14px;
        }
        
        .instructions h4 {
            color: #2980b9;
            margin-bottom: 8px;
        }
        
        .instructions ul {
            margin-left: 20px;
            margin-top: 8px;
        }
        
        .instructions li {
            margin-bottom: 5px;
        }
        
        #sqlInput {
            width: 100%;
            height: 150px;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            resize: vertical;
            font-family: 'Courier New', monospace;
            margin-bottom: 15px;
        }
        
        .btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background-color: #2980b9;
        }
        
        .btn-reset {
            background-color: #95a5a6;
            margin-left: 10px;
        }
        
        .btn-reset:hover {
            background-color: #7f8c8d;
        }
        
        .sql-result-section {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .error-box {
            background: #ffebee;
            color: #b71c1c;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 15px;
            display: none;
        }
        
        .success-box {
            background: #e8f5e9;
            color: #2e7d32;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 15px;
            display: none;
        }
        
        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            display: none;
        }
        
        .result-table th, .result-table td {
            padding: 12px;
            text-align: left;
            border: 1px solid #ddd;
        }
        
        .result-table th {
            background-color: #3498db;
            color: white;
        }
        
        .result-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        .result-table tr:hover {
            background-color: #e3f2fd;
        }
        
        .sample-queries {
            margin-top: 20px;
        }
        
        .sample-btn {
            background-color: #e1f5fe;
            color: #01579b;
            border: 1px solid #b3e5fc;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            margin: 0 5px 5px 0;
            display: inline-block;
        }
        
        .sample-btn:hover {
            background-color: #b3e5fc;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>HKDSE SQLå­¸ç¿’æ¨¡æ“¬å™¨</h1>
            <p>åŸºæ–¼é¦™æ¸¯è—äººæ•¸æ“šåº« | è¦†è“‹DSEèª²ç¨‹å…¨éƒ¨SQLå…§å®¹</p>
        </header>
        
        <div class="main-content">
            <!-- SQLè¼¸å…¥å€åŸŸ -->
            <div class="sql-input-section">
                <h3 class="section-title">ğŸ“ SQLæŒ‡ä»¤è¼¸å…¥</h3>
                
                <div class="instructions">
                    <h4>ğŸ“š DSE SQLèª²ç¨‹æ¶µè“‹å…§å®¹ï¼š</h4>
                    <ul>
                        <li>åŸºæœ¬æŸ¥è©¢ï¼šSELECT * FROM artists</li>
                        <li>å­—æ®µç¯©é¸ï¼šSELECT è—å, å‡ºç”Ÿå¹´ä»½ FROM artists</li>
                        <li>æ¢ä»¶éæ¿¾ï¼šWHERE æ€§åˆ¥='å¥³' æˆ– å‡ºç”Ÿå¹´ä»½>1980</li>
                        <li>æ’åºæŸ¥è©¢ï¼šORDER BY å‡ºé“å¹´ä»½ DESC</li>
                        <li>èšåˆå‡½æ•¸ï¼šCOUNT, SUM, AVG, MAX, MIN</li>
                        <li>åˆ†çµ„æŸ¥è©¢ï¼šGROUP BY ç‹€æ…‹</li>
                        <li>å»é‡æŸ¥è©¢ï¼šSELECT DISTINCT å‡ºç”Ÿåœ° FROM artists</li>
                    </ul>
                    <h4>ğŸ“‹ åˆæ³•å­—æ®µåï¼š</h4>
                    <p>è—åã€æœ¬åã€æ€§åˆ¥ã€å‡ºç”Ÿå¹´ä»½ã€å‡ºç”Ÿåœ°ã€è·æ¥­ã€å‡ºé“å¹´ä»½ã€ä¸»è¦èªè¨€ã€æ‰€å±¬å¹³å°/å» ç‰Œã€ç‹€æ…‹ã€ä»£è¡¨ä½œå“</p>
                </div>
                
                <textarea id="sqlInput" placeholder="è«‹è¼¸å…¥SQLæŸ¥è©¢æŒ‡ä»¤ï¼Œä¾‹å¦‚ï¼š
SELECT è—å, å‡ºç”Ÿå¹´ä»½ FROM artists WHERE æ€§åˆ¥='å¥³'"></textarea>
                
                <button class="btn" onclick="executeSql()">åŸ·è¡ŒSQL</button>
                <button class="btn btn-reset" onclick="resetInput()">æ¸…ç©ºè¼¸å…¥</button>
                
                <div class="sample-queries">
                    <h4>ğŸ’¡ é»æ“Šä½¿ç”¨ç¯„ä¾‹æŸ¥è©¢ï¼š</h4>
                    <button class="sample-btn" onclick="loadSample('basic')">åŸºæœ¬æŸ¥è©¢</button>
                    <button class="sample-btn" onclick="loadSample('filter')">æ¢ä»¶éæ¿¾</button>
                    <button class="sample-btn" onclick="loadSample('sort')">æ’åºæŸ¥è©¢</button>
                    <button class="sample-btn" onclick="loadSample('aggregate')">èšåˆå‡½æ•¸</button>
                    <button class="sample-btn" onclick="loadSample('group')">åˆ†çµ„æŸ¥è©¢</button>
                </div>
            </div>
            
            <!-- SQLçµæœå€åŸŸ -->
            <div class="sql-result-section">
                <h3 class="section-title">ğŸ“Š æŸ¥è©¢çµæœ</h3>
                
                <div id="errorBox" class="error-box"></div>
                <div id="successBox" class="success-box"></div>
                
                <table id="resultTable" class="result-table">
                    <thead id="tableHeader"></thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–è—äººæ•¸æ“šï¼ˆåŸºæ–¼æä¾›çš„æ•¸æ“šï¼‰
        const artistsData = [
            {
                "è—å": "å¼µå­¸å‹", "æœ¬å": "å¼µå­¸å‹", "æ€§åˆ¥": "ç”·", "å‡ºç”Ÿå¹´ä»½": 1961,
                "å‡ºç”Ÿåœ°": "é¦™æ¸¯", "è·æ¥­": "æ­Œæ‰‹ / æ¼”å“¡", "å‡ºé“å¹´ä»½": 1984,
                "ä¸»è¦èªè¨€": "ç²µèª", "æ‰€å±¬å¹³å°/å» ç‰Œ": "ç’°çƒå”±ç‰‡", "ç‹€æ…‹": "æ´»èº",
                "ä»£è¡¨ä½œå“": "ã€Šå»åˆ¥ã€‹ã€Šä¸€è·¯ä¸Šæœ‰ä½ ã€‹"
            },
            {
                "è—å": "é™³å¥•è¿…", "æœ¬å": "é™³å¥•è¿…", "æ€§åˆ¥": "ç”·", "å‡ºç”Ÿå¹´ä»½": 1974,
                "å‡ºç”Ÿåœ°": "é¦™æ¸¯", "è·æ¥­": "æ­Œæ‰‹ / æ¼”å“¡", "å‡ºé“å¹´ä»½": 1995,
                "ä¸»è¦èªè¨€": "ç²µèª", "æ‰€å±¬å¹³å°/å» ç‰Œ": "ç’°çƒå”±ç‰‡", "ç‹€æ…‹": "æ´»èº",
                "ä»£è¡¨ä½œå“": "ã€ŠKæ­Œä¹‹ç‹ã€‹ã€Šåå¹´ã€‹"
            },
            {
                "è—å": "æ¢…è‰·èŠ³", "æœ¬å": "æ¢…è‰·èŠ³", "æ€§åˆ¥": "å¥³", "å‡ºç”Ÿå¹´ä»½": 1963,
                "å‡ºç”Ÿåœ°": "é¦™æ¸¯", "è·æ¥­": "æ­Œæ‰‹ / æ¼”å“¡", "å‡ºé“å¹´ä»½": 1982,
                "ä¸»è¦èªè¨€": "ç²µèª", "æ‰€å±¬å¹³å°/å» ç‰Œ": "è¯æ˜Ÿå”±ç‰‡", "ç‹€æ…‹": "å·²æ•…",
                "ä»£è¡¨ä½œå“": "ã€Šå¥³äººèŠ±ã€‹ã€Šå£å¥³å­©ã€‹"
            },
            {
                "è—å": "å¼µåœ‹æ¦®", "æœ¬å": "å¼µåœ‹æ¦®", "æ€§åˆ¥": "ç”·", "å‡ºç”Ÿå¹´ä»½": 1956,
                "å‡ºç”Ÿåœ°": "é¦™æ¸¯", "è·æ¥­": "æ­Œæ‰‹ / æ¼”å“¡", "å‡ºé“å¹´ä»½": 1985,
                "ä¸»è¦èªè¨€": "ç²µèª", "æ‰€å±¬å¹³å°/å» ç‰Œ": "è¯æ˜Ÿå”±ç‰‡", "ç‹€æ…‹": "å·²æ•…",
                "ä»£è¡¨ä½œå“": "ã€Šæ²‰é»˜æ˜¯é‡‘ã€‹ã€Šç”·äººå“­å§ä¸æ˜¯ç½ªã€‹"
            },
            {
                "è—å": "åŠ‰å¾·è¯", "æœ¬å": "åŠ‰ç¦æ¦®", "æ€§åˆ¥": "ç”·", "å‡ºç”Ÿå¹´ä»½": 1961,
                "å‡ºç”Ÿåœ°": "é¦™æ¸¯", "è·æ¥­": "æ­Œæ‰‹ / æ¼”å“¡", "å‡ºé“å¹´ä»½": 1999,
                "ä¸»è¦èªè¨€": "ç²µèª", "æ‰€å±¬å¹³å°/å» ç‰Œ": "å¯°äºéŸ³æ¨‚", "ç‹€æ…‹": "æ´»èº",
                "ä»£è¡¨ä½œå“": "ã€Šå¿˜æƒ…æ°´ã€‹ã€Šå¿ƒç¶“ã€‹"
            },
            {
                "è—å": "å®¹ç¥–å…’", "æœ¬å": "å®¹ç¥–å…’", "æ€§åˆ¥": "å¥³", "å‡ºç”Ÿå¹´ä»½": 1980,
                "å‡ºç”Ÿåœ°": "é¦™æ¸¯", "è·æ¥­": "æ­Œæ‰‹", "å‡ºé“å¹´ä»½": 1999,
                "ä¸»è¦èªè¨€": "ç²µèª", "æ‰€å±¬å¹³å°/å» ç‰Œ": "è‹±çš‡å¨›æ¨‚", "ç‹€æ…‹": "æ´»èº",
                "ä»£è¡¨ä½œå“": "ã€Šç¿’æ…£å¤±æˆ€ã€‹ã€Šå¿ƒæ·¡ã€‹"
            },
            {
                "è—å": "è¬å®‰çª", "æœ¬å": "è¬å®‰çª", "æ€§åˆ¥": "å¥³", "å‡ºç”Ÿå¹´ä»½": 1977,
                "å‡ºç”Ÿåœ°": "é¦™æ¸¯", "è·æ¥­": "æ­Œæ‰‹", "å‡ºé“å¹´ä»½": 2005,
                "ä¸»è¦èªè¨€": "ç²µèª", "æ‰€å±¬å¹³å°/å» ç‰Œ": "æ–°è—å¯¶å”±ç‰‡", "ç‹€æ…‹": "æ´»èº",
                "ä»£è¡¨ä½œå“": "ã€Šå–œå¸–è¡—ã€‹ã€Šé¾ç„¡è‰·ã€‹"
            },
            {
                "è—å": "å¼µæ•¬è»’", "æœ¬å": "å¼µæ•¬è»’", "æ€§åˆ¥": "ç”·", "å‡ºç”Ÿå¹´ä»½": 1981,
                "å‡ºç”Ÿåœ°": "å»£å·", "è·æ¥­": "æ­Œæ‰‹", "å‡ºé“å¹´ä»½": 2002,
                "ä¸»è¦èªè¨€": "ç²µèª", "æ‰€å±¬å¹³å°/å» ç‰Œ": "è‹±çš‡å¨›æ¨‚", "ç‹€æ…‹": "æ´»èº",
                "ä»£è¡¨ä½œå“": "ã€Šé…·æ„›ã€‹ã€Šæ«»èŠ±æ¨¹ä¸‹ã€‹"
            },
            {
                "è—å": "è¨±å»·é—", "æœ¬å": "è¨±å»·é—", "æ€§åˆ¥": "ç”·", "å‡ºç”Ÿå¹´ä»½": 1988,
                "å‡ºç”Ÿåœ°": "é¦™æ¸¯", "è·æ¥­": "æ­Œæ‰‹", "å‡ºé“å¹´ä»½": 2010,
                "ä¸»è¦èªè¨€": "ç²µèª", "æ‰€å±¬å¹³å°/å» ç‰Œ": "æ˜Ÿå¤¢å¨›æ¨‚", "ç‹€æ…‹": "æ´»èº",
                "ä»£è¡¨ä½œå“": "ã€Šé¢å…·ã€‹ã€Šé’æ˜¥é Œã€‹"
            },
            {
                "è—å": "é™³æŸå®‡", "æœ¬å": "é™³æŸå®‡", "æ€§åˆ¥": "ç”·", "å‡ºç”Ÿå¹´ä»½": 1983,
                "å‡ºç”Ÿåœ°": "é¦™æ¸¯", "è·æ¥­": "æ­Œæ‰‹", "å‡ºé“å¹´ä»½": 2007,
                "ä¸»è¦èªè¨€": "ç²µèª", "æ‰€å±¬å¹³å°/å» ç‰Œ": "Sony Music", "ç‹€æ…‹": "æ´»èº",
                "ä»£è¡¨ä½œå“": "ã€Šä½ çæˆ‘çã€‹ã€Šé€¸å¾Œã€‹"
            },
            {
                "è—å": "æ—å®¶è¬™", "æœ¬å": "æ—å®¶è¬™", "æ€§åˆ¥": "ç”·", "å‡ºç”Ÿå¹´ä»½": 1991,
                "å‡ºç”Ÿåœ°": "é¦™æ¸¯", "è·æ¥­": "æ­Œæ‰‹ / éŸ³æ¨‚è£½ä½œäºº", "å‡ºé“å¹´ä»½": 2019,
                "ä¸»è¦èªè¨€": "ç²µèª", "æ‰€å±¬å¹³å°/å» ç‰Œ": "Terence Lam Production", "ç‹€æ…‹": "æ´»èº",
                "ä»£è¡¨ä½œå“": "ã€Šä¸‹ä¸€å€‹ç« ç¯€ã€‹ã€Šä¸€äººä¹‹å¢ƒã€‹"
            }
        ];

        // åˆæ³•å­—æ®µå
        const validColumns = Object.keys(artistsData[0]);
        
        // åŠ è¼‰ç¯„ä¾‹æŸ¥è©¢
        function loadSample(type) {
            const sqlInput = document.getElementById('sqlInput');
            
            switch(type) {
                case 'basic':
                    sqlInput.value = 'SELECT è—å, æœ¬å, å‡ºç”Ÿå¹´ä»½ FROM artists';
                    break;
                case 'filter':
                    sqlInput.value = 'SELECT è—å, è·æ¥­ FROM artists WHERE æ€§åˆ¥="å¥³"';
                    break;
                case 'sort':
                    sqlInput.value = 'SELECT è—å, å‡ºé“å¹´ä»½ FROM artists ORDER BY å‡ºé“å¹´ä»½ DESC';
                    break;
                case 'aggregate':
                    sqlInput.value = 'SELECT COUNT(*) FROM artists WHERE ç‹€æ…‹="æ´»èº"';
                    break;
                case 'group':
                    sqlInput.value = 'SELECT æ€§åˆ¥, COUNT(*) FROM artists GROUP BY æ€§åˆ¥';
                    break;
            }
        }
        
        // æ¸…ç©ºè¼¸å…¥æ¡†
        function resetInput() {
            document.getElementById('sqlInput').value = '';
            document.getElementById('errorBox').style.display = 'none';
            document.getElementById('successBox').style.display = 'none';
            document.getElementById('resultTable').style.display = 'none';
        }
        
        // æª¢æ¸¬SQLéŒ¯èª¤
        function detectSqlErrors(sqlCmd) {
            const errors = [];
            const sqlLower = sqlCmd.toLowerCase().trim();
            
            // 1. æª¢æŸ¥æ˜¯å¦ä»¥SELECTé–‹é ­
            if (!sqlLower.startsWith('select')) {
                errors.push("SQLæŒ‡ä»¤å¿…é ˆä»¥SELECTé–‹é ­ï¼ˆDSE SQLæ ¸å¿ƒç‚ºæŸ¥è©¢èªå¥ï¼‰");
            } else {
                // 2. æª¢æŸ¥æ˜¯å¦åŒ…å«FROMå­å¥
                if (!sqlLower.includes('from')) {
                    errors.push("ç¼ºå°‘å¿…è¦çš„FROMå­å¥ï¼Œå¿…é ˆæŒ‡å®šè¦æŸ¥è©¢çš„æ•¸æ“šè¡¨");
                } else {
                    // 3. æª¢æŸ¥è¡¨åæ˜¯å¦æ­£ç¢º
                    const fromMatch = sqlLower.match(/from\s+(\w+)/);
                    if (fromMatch && fromMatch[1] !== 'artists') {
                        errors.push(`æ•¸æ“šè¡¨åéŒ¯èª¤ï¼Œåƒ…æ”¯æŒartistsè¡¨ï¼ˆä½ è¼¸å…¥äº†${fromMatch[1]}ï¼‰`);
                    }
                }
                
                // 4. æª¢æŸ¥å­—æ®µåæ˜¯å¦åˆæ³•
                if (sqlLower.includes('from')) {
                    const selectPart = sqlLower.split('from')[0].replace('select', '').trim();
                    if (selectPart !== '*') {
                        const columns = selectPart.split(',').map(col => col.trim());
                        columns.forEach(col => {
                            // è™•ç†èšåˆå‡½æ•¸
                            const colClean = col.replace(/(count|sum|avg|max|min)\((.*?)\)/, '$2').trim();
                            if (colClean && colClean !== '*' && !validColumns.includes(colClean)) {
                                errors.push(`å­—æ®µå'${colClean}'ä¸å­˜åœ¨ï¼Œåˆæ³•å­—æ®µï¼š${validColumns.join('ã€')}`);
                            }
                        });
                    }
                }
                
                // 5. æª¢æŸ¥ORDER BYèªæ³•
                if (sqlLower.includes('order by')) {
                    const orderMatch = sqlLower.match(/order by\s+(\w+)/);
                    if (orderMatch) {
                        const orderCol = orderMatch[1].trim();
                        if (!validColumns.includes(orderCol)) {
                            errors.push(`æ’åºå­—æ®µ'${orderCol}'ä¸å­˜åœ¨ï¼Œåˆæ³•å­—æ®µï¼š${validColumns.join('ã€')}`);
                        }
                    }
                }
                
                // 6. æª¢æŸ¥GROUP BYèªæ³•
                if (sqlLower.includes('group by')) {
                    const groupMatch = sqlLower.match(/group by\s+(\w+)/);
                    if (groupMatch) {
                        const groupCol = groupMatch[1].trim();
                        if (!validColumns.includes(groupCol)) {
                            errors.push(`åˆ†çµ„å­—æ®µ'${groupCol}'ä¸å­˜åœ¨ï¼Œåˆæ³•å­—æ®µï¼š${validColumns.join('ã€')}`);
                        }
                    }
                }
                
                // 7. æª¢æŸ¥èšåˆå‡½æ•¸èªæ³•
                const aggFunctions = ['count(', 'sum(', 'avg(', 'max(', 'min('];
                aggFunctions.forEach(func => {
                    if (sqlLower.includes(func)) {
                        const openCount = (sqlLower.match(new RegExp(func, 'g')) || []).length;
                        const closeCount = (sqlLower.match(/\)/g) || []).length;
                        if (openCount > closeCount) {
                            errors.push(`èšåˆå‡½æ•¸${func.slice(0, -1)}èªæ³•éŒ¯èª¤ï¼Œç¼ºå°‘é–‰åˆæ‹¬è™Ÿ)`);
                        }
                    }
                });
                
                // 8. æª¢æŸ¥WHEREå­å¥
                if (sqlLower.includes('where')) {
                    let wherePart = sqlLower.split('where')[1];
                    if (wherePart.includes('order by')) wherePart = wherePart.split('order by')[0];
                    if (wherePart.includes('group by')) wherePart = wherePart.split('group by')[0];
                    if (wherePart.trim() === '') {
                        errors.push("WHEREå­å¥å¾Œç¼ºå°‘éæ¿¾æ¢ä»¶");
                    }
                }
            }
            
            return errors;
        }
        
        // åŸ·è¡ŒSQLæŸ¥è©¢
        function executeSqlQuery(sqlCmd) {
            const sqlLower = sqlCmd.toLowerCase();
            let result = JSON.parse(JSON.stringify(artistsData)); // æ·±æ‹·è²æ•¸æ“š
            let selectedColumns = [...validColumns];
            
            // 1. è™•ç†SELECTå­å¥
            if (sqlLower.includes('from')) {
                const selectPart = sqlLower.split('from')[0].replace('select', '').trim();
                
                // è™•ç†å­—æ®µé¸æ“‡
                if (selectPart !== '*') {
                    const columns = selectPart.split(',').map(col => col.trim());
                    const colNames = [];
                    const aggResults = {};
                    let hasAggregation = false;
                    
                    columns.forEach(col => {
                        // è™•ç†èšåˆå‡½æ•¸
                        const aggMatch = col.match(/(count|sum|avg|max|min)\((.*?)\)/);
                        if (aggMatch) {
                            hasAggregation = true;
                            const func = aggMatch[1];
                            const aggCol = aggMatch[2].trim();
                            
                            if (aggCol === '*' && func === 'count') {
                                aggResults['count(*)'] = result.length;
                            } else if (validColumns.includes(aggCol)) {
                                const colValues = result.map(item => item[aggCol]);
                                
                                if (func === 'count') {
                                    aggResults[`count(${aggCol})`] = colValues.filter(val => val !== undefined).length;
                                } else if (func === 'sum' || func === 'avg') {
                                    const numericValues = colValues.filter(val => !isNaN(parseInt(val))).map(Number);
                                    if (numericValues.length === 0) {
                                        throw new Error(`SUM/AVGå‡½æ•¸åƒ…é©ç”¨æ–¼æ•¸å€¼å‹å­—æ®µï¼ˆ${aggCol}ä¸æ˜¯æ•¸å€¼å‹ï¼‰`);
                                    }
                                    
                                    const sum = numericValues.reduce((a, b) => a + b, 0);
                                    if (func === 'sum') {
                                        aggResults[`sum(${aggCol})`] = sum;
                                    } else {
                                        aggResults[`avg(${aggCol})`] = (sum / numericValues.length).toFixed(2);
                                    }
                                } else if (func === 'max') {
                                    const numericValues = colValues.filter(val => !isNaN(parseInt(val))).map(Number);
                                    aggResults[`max(${aggCol})`] = Math.max(...numericValues);
                                } else if (func === 'min') {
                                    const numericValues = colValues.filter(val => !isNaN(parseInt(val))).map(Number);
                                    aggResults[`min(${aggCol})`] = Math.min(...numericValues);
                                }
                            }
                        } else {
                            // æ™®é€šå­—æ®µ
                            if (validColumns.includes(col)) {
                                colNames.push(col);
                            }
                        }
                    });
                    
                    // å¦‚æœæœ‰èšåˆå‡½æ•¸ï¼Œç›´æ¥è¿”å›
                    if (hasAggregation && Object.keys(aggResults).length > 0) {
                        return {
                            headers: Object.keys(aggResults),
                            data: [Object.values(aggResults)]
                        };
                    }
                    
                    // æ‡‰ç”¨å­—æ®µç¯©é¸
                    if (colNames.length > 0) {
                        selectedColumns = colNames;
                        result = result.map(item => {
                            const newItem = {};
                            colNames.forEach(col => {
                                newItem[col] = item[col];
                            });
                            return newItem;
                        });
                    }
                    
                    // è™•ç†å»é‡
                    if (selectPart.includes('distinct')) {
                        const seen = new Set();
                        result = result.filter(item => {
                            const key = JSON.stringify(item);
                            if (!seen.has(key)) {
                                seen.add(key);
                                return true;
                            }
                            return false;
                        });
                    }
                }
            }
            
            // 2. è™•ç†WHEREå­å¥
            if (sqlLower.includes('where')) {
                let wherePart = sqlLower.split('where')[1];
                if (wherePart.includes('order by')) wherePart = wherePart.split('order by')[0];
                if (wherePart.includes('group by')) wherePart = wherePart.split('group by')[0];
                wherePart = wherePart.trim();
                
                result = filterByWhereClause(result, wherePart);
            }
            
            // 3. è™•ç†GROUP BYå­å¥
            if (sqlLower.includes('group by')) {
                const groupMatch = sqlLower.match(/group by\s+(\w+)/);
                if (groupMatch) {
                    const groupCol = groupMatch[1];
                    
                    const groups = {};
                    result.forEach(item => {
                        const key = item[groupCol];
                        groups[key] = (groups[key] || 0) + 1;
                    });
                    
                    // è½‰æ›çµæœæ ¼å¼
                    selectedColumns = ['åˆ†çµ„å­—æ®µ', 'æ•¸é‡'];
                    result = Object.entries(groups).map(([key, value]) => ({
                        'åˆ†çµ„å­—æ®µ': key,
                        'æ•¸é‡': value
                    }));
                }
            }
            
            // 4. è™•ç†ORDER BYå­å¥
            if (sqlLower.includes('order by')) {
                const orderMatch = sqlLower.match(/order by\s+(\w+)\s*(asc|desc)?/);
                if (orderMatch) {
                    const orderCol = orderMatch[1];
                    const orderDir = (orderMatch[2] || 'asc').toLowerCase();
                    
                    result.sort((a, b) => {
                        const valA = a[orderCol];
                        const valB = b[orderCol];
                        
                        // æ•¸å€¼æ¯”è¼ƒ
                        if (!isNaN(parseInt(valA)) && !isNaN(parseInt(valB))) {
                            return orderDir === 'asc' 
                                ? parseInt(valA) - parseInt(valB) 
                                : parseInt(valB) - parseInt(valA);
                        }
                        
                        // å­—ç¬¦ä¸²æ¯”è¼ƒ
                        return orderDir === 'asc' 
                            ? valA.localeCompare(valB, 'zh-HK') 
                            : valB.localeCompare(valA, 'zh-HK');
                    });
                }
            }
            
            // æ ¼å¼åŒ–çµæœ
            const formattedData = result.map(item => {
                const row = [];
                selectedColumns.forEach(col => {
                    row.push(item[col] || '');
                });
                return row;
            });
            
            return {
                headers: selectedColumns,
                data: formattedData
            };
        }
        
        // WHEREæ¢ä»¶éæ¿¾
        function filterByWhereClause(data, condition) {
            const operators = ['>=', '<=', '!=', '=', '>', '<'];
            let operator = '';
            
            // æ‰¾åˆ°é‹ç®—ç¬¦
            for (const op of operators) {
                if (condition.includes(op)) {
                    operator = op;
                    break;
                }
            }
            
            if (!operator) {
                throw new Error(`WHEREæ¢ä»¶é‹ç®—ç¬¦éŒ¯èª¤ï¼Œæ”¯æŒçš„é‹ç®—ç¬¦ï¼š${operators.join('ã€')}`);
            }
            
            // æ‹†åˆ†å­—æ®µå’Œå€¼
            const [colName, valueStr] = condition.split(operator).map(part => part.trim());
            if (!colName || !valueStr) {
                throw new Error("WHEREæ¢ä»¶æ ¼å¼éŒ¯èª¤ï¼Œæ­£ç¢ºæ ¼å¼ï¼šå­—æ®µå é‹ç®—ç¬¦ 'å€¼'");
            }
            
            // é©—è­‰å­—æ®µå
            if (!validColumns.includes(colName)) {
                throw new Error(`WHEREæ¢ä»¶ä¸­çš„å­—æ®µ'${colName}'ä¸å­˜åœ¨`);
            }
            
            // è™•ç†å€¼ï¼ˆå»é™¤å¼•è™Ÿï¼‰
            const value = valueStr.replace(/['"]/g, '');
            
            // åŸ·è¡Œéæ¿¾
            return data.filter(item => {
                const cellValue = item[colName];
                
                // æ•¸å€¼æ¯”è¼ƒ
                if (!isNaN(parseInt(cellValue)) && !isNaN(parseInt(value))) {
                    const numCell = parseInt(cellValue);
                    const numValue = parseInt(value);
                    
                    switch (operator) {
                        case '=': return numCell === numValue;
                        case '>': return numCell > numValue;
                        case '<': return numCell < numValue;
                        case '>=': return numCell >= numValue;
                        case '<=': return numCell <= numValue;
                        case '!=': return numCell !== numValue;
                    }
                }
                
                // å­—ç¬¦ä¸²æ¯”è¼ƒ
                switch (operator) {
                    case '=': return cellValue === value;
                    case '!=': return cellValue !== value;
                    default: throw new Error(`å­—ç¬¦ä¸²æ¯”è¼ƒåƒ…æ”¯æŒ = å’Œ != é‹ç®—ç¬¦ï¼ˆä½ ä½¿ç”¨äº†${operator}ï¼‰`);
                }
            });
        }
        
        // é¡¯ç¤ºçµæœè¡¨æ ¼
        function displayResult(result) {
            const headerElement = document.getElementById('tableHeader');
            const bodyElement = document.getElementById('tableBody');
            
            // æ¸…ç©ºèˆŠå…§å®¹
            headerElement.innerHTML = '';
            bodyElement.innerHTML = '';
            
            // å‰µå»ºè¡¨é ­
            const headerRow = document.createElement('tr');
            result.headers.forEach(header => {
                const th = document.createElement('th');
                th.textContent = header;
                headerRow.appendChild(th);
            });
            headerElement.appendChild(headerRow);
            
            // å‰µå»ºè¡¨æ ¼å…§å®¹
            result.data.forEach(row => {
                const tr = document.createElement('tr');
                row.forEach(cell => {
                    const td = document.createElement('td');
                    td.textContent = cell;
                    tr.appendChild(td);
                });
                bodyElement.appendChild(tr);
            });
            
            // é¡¯ç¤ºè¡¨æ ¼
            document.getElementById('resultTable').style.display = 'table';
        }
        
        // ä¸»åŸ·è¡Œå‡½æ•¸
        function executeSql() {
            const sqlInput = document.getElementById('sqlInput');
            const sqlCmd = sqlInput.value.trim();
            const errorBox = document.getElementById('errorBox');
            const successBox = document.getElementById('successBox');
            
            // é‡ç½®é¡¯ç¤ºç‹€æ…‹
            errorBox.style.display = 'none';
            successBox.style.display = 'none';
            document.getElementById('resultTable').style.display = 'none';
            
            // ç©ºè¼¸å…¥æª¢æŸ¥
            if (!sqlCmd) {
                errorBox.textContent = 'è«‹è¼¸å…¥æœ‰æ•ˆçš„SQLæŸ¥è©¢æŒ‡ä»¤ï¼';
                errorBox.style.display = 'block';
                return;
            }
            
            // ç¬¬ä¸€æ­¥ï¼šæª¢æ¸¬éŒ¯èª¤
            const errors = detectSqlErrors(sqlCmd);
            if (errors.length > 0) {
                errorBox.textContent = 'âŒ æª¢æ¸¬åˆ°SQLèªæ³•éŒ¯èª¤ï¼š\n' + errors.join('\n');
                errorBox.style.display = 'block';
                return;
            }
            
            // ç¬¬äºŒæ­¥ï¼šåŸ·è¡ŒSQLæŸ¥è©¢
            try {
                const result = executeSqlQuery(sqlCmd);
                
                // é¡¯ç¤ºæˆåŠŸä¿¡æ¯
                successBox.textContent = `âœ… SQLåŸ·è¡ŒæˆåŠŸï¼å…±è¿”å› ${result.data.length} æ¢è¨˜éŒ„`;
                successBox.style.display = 'block';
                
                // é¡¯ç¤ºçµæœ
                displayResult(result);
                
            } catch (error) {
                errorBox.textContent = `âŒ SQLåŸ·è¡Œå‡ºéŒ¯ï¼š${error.message}\nğŸ’¡ æç¤ºï¼šè«‹æª¢æŸ¥èªæ³•æ ¼å¼ï¼Œä¾‹å¦‚å­—ç¬¦ä¸²éœ€åŠ å¼•è™Ÿï¼Œæ•¸å€¼ä¸éœ€è¦å¼•è™Ÿ`;
                errorBox.style.display = 'block';
            }
        }
    </script>
</body>

</html>
